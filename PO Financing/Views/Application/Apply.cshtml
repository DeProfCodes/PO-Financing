@{
    ViewData["Title"] = "Apply";
}

<link href="../assets/css/style-admin.css" rel="stylesheet">

<div class="container">
    <section class="min-vh-100 d-flex flex-column align-items-center py-4">
        <div style="margin-top:130px; width: 80%; margin-bottom: 70px">
            <div class="pagetitle">
                <h1>Apply</h1>
                <nav>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Dashboard">Home</a></li>
                        <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Dashboard">Dashboard</a></li>
                        <li class="breadcrumb-item active">Apply</li>
                    </ol>
                </nav>
            </div><!-- End Page Title -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Please fill in the details</h5>

                    <!-- Bordered Tabs -->
                    <ul class="nav nav-tabs nav-tabs-bordered" id="borderedTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#bordered-personal" type="button" role="tab" aria-controls="personal" aria-selected="true">Personal</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#bordered-business" type="button" role="tab" aria-controls="business" aria-selected="false">Business</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="poOrder-tab" data-bs-toggle="tab" data-bs-target="#bordered-poOrder" type="button" role="tab" aria-controls="poOrder" aria-selected="false">Purchase Order</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#bordered-documents" type="button" role="tab" aria-controls="documents" aria-selected="false">Documents</button>
                        </li>
                    </ul>
                    <div class="tab-content pt-2" id="borderedTabContent">
                        <!-- Personal Tab -->
                        <div class="tab-pane fade show active" id="bordered-personal" role="tabpanel" aria-labelledby="personal-tab">
                                <div class="apply-info-dialog-container">
                                    <h4 class="w-100 text-center">Enter your details</h4>
                                    <div class="apply-info-dialog">
                                        <div class="row mb-3 hidden">
                                            <label for="inputText" class="col-sm-3 col-form-label">Firstname*</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control apply-textBox">
                                            </div>
                                        </div>
                                        <div class="row mb-3 hidden">
                                            <label for="inputText" class="col-sm-3 col-form-label">Lastname*</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control apply-textBox">
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputText" class="col-sm-3 col-form-label">ID Number*</label>
                                            <div class="col-sm-9">
                                                <input type="number" class="form-control apply-textBox" id="idNum">
                                                <span id="idNumValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputEmail" class="col-sm-3 col-form-label">Business Email*</label>
                                            <div class="col-sm-9">
                                                <input type="email" class="form-control apply-textBox" id="bEmail">
                                                <span id="emailValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputEmail" class="col-sm-3 col-form-label">Phone Number*</label>
                                            <div class="col-sm-9">
                                                <input type="number" class="form-control apply-textBox" id="cell">
                                                <span id="cellValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <button class="btn default-btn apply-next-btn" onclick="ValidatePersonalTab()">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- Business Tab -->
                        <div class="tab-pane fade" id="bordered-business" role="tabpanel" aria-labelledby="business-tab">
                                <div class="apply-info-dialog-container">
                                    <h4 class="w-100 text-center">Enter Business Details</h4>
                                    <div class="apply-info-dialog">
                                        <div class="row mb-3">
                                            <label for="inputText" class="col-sm-3 col-form-label">Business Name*</label>
                                            <div class="col-sm-9">
                                                <input type="text" id="bName" class="form-control apply-textBox">
                                                <span id="bNameValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputText" class="col-sm-3 col-form-label">Registration Number*</label>
                                            <div class="col-sm-9">
                                                <input type="text" id="regNum" class="form-control apply-textBox">
                                                <span id="regNumValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputText" class="col-sm-3 col-form-label">Website</label>
                                            <div class="col-sm-9">
                                                <input type="text" id="web" class="form-control apply-textBox">
                                                <span id="webValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label">Address*</label>
                                            <div class="col-sm-9">
                                                <input type="text" id="address" class="form-control apply-textBox">
                                                <span id="addressValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <button class="btn default-btn apply-next-btn" onclick="ValidateBusinessTab()">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- Purchase Order Tab -->
                        <div class="tab-pane fade" id="bordered-poOrder" role="tabpanel" aria-labelledby="poOrder-tab">
                                <div class="apply-info-dialog-container">
                                    <h4 class="w-100 text-center">Purchase Order Details</h4>
                                    <div class="apply-info-dialog">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="poDesc" placeholder="name@example.com">
                                            <label for="floatingInput">What is purchase order for?</label>
                                            <span id="poDescValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <select class="form-select" id="poFunder" aria-label="Floating label select example">
                                                <option value="1" selected>SA Government</option>
                                                <option value="2">Large Corporation</option>
                                                <option value="3">Another Business</option>
                                                <option value="4">An Individual</option>
                                            </select>
                                            <label for="floatingSelect">Who is purchase order for</label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="contactPerson" placeholder="0123456789">
                                            <label for="floatingInput">Primary Contact Person Phone Number</label>
                                            <span id="contactPersonValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="date" class="form-control" id="poIssueDate">
                                            <label for="floatingInput">Purchase Order Issue Date</label>
                                            <span id="poIssueDateValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="date" class="form-control" id="poDueDate">
                                            <label for="floatingInput">Purchase Order Due Date</label>
                                            <span id="poDueDateValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="poAmt" placeholder="R5000">
                                            <label for="floatingInput">Purchase Order Amount</label>
                                            <span id="poAmtValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="invAmt" placeholder="R3000">
                                            <label for="floatingInput">Quotation Amount</label>
                                            <span id="invAmtValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="poOrdNum" placeholder="789645">
                                            <label for="floatingInput">Purchase Order Number</label>
                                            <span id="poNumValid" class="text-danger"></span>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="goodsSupplier" placeholder="Supplier Name">
                                            <label for="floatingInput">Supplier of Goods</label>
                                            <span id="goodsSupplierValid" class="text-danger"></span>
                                        </div>
                                        <div class="row mb-3">
                                            <button class="btn default-btn apply-next-btn" onclick="ValidatePurchaseOrderTab()">Save</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- Documents Tab -->
                        <div class="tab-pane fade" id="bordered-documents" role="tabpanel" aria-labelledby="documents-tab">
                            <div class="apply-info-dialog-container">
                                <h4 class="w-100 text-center">Upload Documents</h4>
                                <div class="apply-info-dialog">
                                    <form asp-action="Upload"  asp-controller="Uploads" enctype="multipart/form-data" method="post" id="DocumentsForm">
                                        <div class="row mb-3">
                                            <label for="inputNumber" class="col-sm-5 col-form-label">Business registration document</label>
                                            <div class="col-sm-7">
                                                <input class="form-control" type="file" name="files" id="businessRegistrationDoc">
                                                <span id="businessRegistrationDocValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputNumber" class="col-sm-5 col-form-label">Director's ID document</label>
                                            <div class="col-sm-7">
                                                <input class="form-control" type="file" name="files" id="directorIdDoc">
                                                <span id="directorIdDocValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputNumber" class="col-sm-5 col-form-label">Purchase Order</label>
                                            <div class="col-sm-7">
                                                <input class="form-control" type="file" name="files" id="PurchaseOrderDoc">
                                                <span id="PurchaseOrderDocValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label for="inputNumber" class="col-sm-5 col-form-label">Quotation</label>
                                            <div class="col-sm-7">
                                                <input class="form-control" type="file" name="files" id="QuoationDoc">
                                                <span id="QuoationDocValid" class="text-danger"></span>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <button class="btn default-btn apply-next-btn" type="button" onclick="ValidateDocumentsTab()">Submit</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div><!-- End Bordered Tabs -->
                </div>
            </div>
        </div>
    </section>
</div>

<script>

    localStorage['currentPage'] = 'Apply';

    function ValidatePersonalTab() 
    {
        var allValid = ValidatePersonalInfoApply();
        if (allValid) 
        {
            alert("All Good unto Next Tab");
            //Progress to next tab
        }
    }

    function ValidateBusinessTab()
    {
        var allValid = ValidateBusinessInfoApply();
        if (allValid) 
        {
            alert("All Good unto Next Tab");
            //Progress to next tab
        }
    }

    function ValidatePurchaseOrderTab() 
    {
        var allValid = ValidatePurchaseOrderInfoApply();
        if (allValid) 
        {
            alert("All Good unto Next Tab");
            //Progress to next tab
        }
    }

    function CreateApplication()
    {
        var idNum =  $("#idNum").val();
        var bEmail = $("#bEmail").val();
        var cell = $("#cell").val();

        var bName = $("#bName").val();
        var regNum = $("#regNum").val();
        var web = $("#web").val();
        var address = $("#address").val();

        var poDesc = $("#poDesc").val();
        var poFunder = $("#poFunder").val();
        var contactPerson = $("#contactPerson").val();
        var poIssueDate = $("#poIssueDate").val();
        var poDueDate = $("#poDueDate").val();
        var poAmt = $("#poAmt").val();
        var invAmt = $("#invAmt").val();
        var poOrdNum = $("#poOrdNum").val();
        var goodsSupplier = $("#goodsSupplier").val();

        var personalArgs = "IdNumber="+idNum+"&BusinessEmail="+bEmail+"&PhoneNumber="+cell;
        var businessArgs = "BusinessName="+bName+"&BusinessRegistrationNumber="+regNum+"&Website="+web+"&Address="+address;
        var PoArgs = "PurchaseOrderDescription="+poDesc+"&PurchaseOrderFunder="+poFunder+"&PrimaryPersonPhoneNumber="+contactPerson+"&PurchaseOrderIssueDate="+poIssueDate+
                    "&PurchaseOrderDueDate="+poDueDate+"&PurchaseOrderAmount="+poAmt+"&InvoiceAmount="+invAmt+"&PurchaseOrderNumber="+poOrdNum+"&SupplierOfGoods="+goodsSupplier;
        
        var args = personalArgs + "&" + businessArgs + "&" + PoArgs;
        var url = "@Url.Action("CreateApplication", "Application")?"+args;
        
        $.ajax({
            type: "GET",
            url: url,
            async: true,
            success: function (data) 
            {
                $("#DocumentsForm").submit();
            },
            error: function (error) 
            {
                alert("Something went wrong with your application");
            }
        })
    }

    function ValidateDocumentsTab() 
    {
        var allValid = ValidateDocumentsApply();
        if (allValid) 
        {
            CreateApplication();
        }
    }
</script>

<script src="../assets/js/jquery.js"></script>
